<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>Tax Calculator - Philippine Tax Calculation Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00ff9d;
            --secondary-color: #0a0f1a;
            --card-bg: rgba(0, 30, 20, 0.9);
            --text-color: #e0f7e9;
            --text-secondary: #80ffd4;
            --sidebar-bg: rgba(0, 20, 15, 0.98);
            --sidebar-width: 280px;
            --success-color: #00ff9d;
            --warning-color: #ff9900;
            --danger-color: #ff3333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0f1a 0%, #0d1913 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            border-right: 2px solid rgba(0, 255, 157, 0.3);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
            background: rgba(0, 30, 20, 0.8);
        }
        
        .sidebar-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0 15px;
        }
        
        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(0, 30, 20, 0.6);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sidebar-btn:hover {
            background: rgba(0, 40, 25, 0.8);
            border-color: rgba(0, 255, 157, 0.3);
            transform: translateX(5px);
        }
        
        .sidebar-btn.active {
            background: rgba(0, 255, 157, 0.15);
            border-color: rgba(0, 255, 157, 0.5);
        }
        
        .sidebar-btn i {
            font-size: 1.25rem;
            color: var(--primary-color);
            width: 25px;
        }
        
        .sidebar-btn-text {
            font-size: 1rem;
            font-weight: 500;
        }
        
        .sidebar-divider {
            height: 1px;
            background: rgba(0, 255, 157, 0.2);
            margin: 20px 15px;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 255, 157, 0.2);
            text-align: center;
            font-size: 0.85rem;
            color: #80cbc4;
            background: rgba(0, 20, 15, 0.8);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            max-width: 1400px;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(0, 30, 20, 0.9) 0%, rgba(0, 40, 25, 0.95) 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
        }
        
        .header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 800px;
        }
        
        /* Calculator Container */
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Calculator Card */
        .calculator-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(0, 255, 157, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .calculator-card:hover {
            border-color: rgba(0, 255, 157, 0.3);
            transform: translateY(-2px);
        }
        
        .calculator-card h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .calculator-card h2 i {
            color: var(--primary-color);
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a7ffeb;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(5, 20, 15, 0.8);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 255, 157, 0.2);
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group .currency {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .input-group input {
            padding-left: 40px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .radio-label input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }
        
        /* Results Section */
        .results-card {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(0, 40, 25, 0.9) 0%, rgba(0, 60, 35, 0.85) 100%);
            border: 2px solid var(--primary-color);
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            background: rgba(0, 30, 20, 0.6);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .result-label {
            font-size: 0.9rem;
            color: #80ffd4;
            margin-bottom: 8px;
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }
        
        .result-subtext {
            font-size: 0.85rem;
            color: #80cbc4;
            margin-top: 5px;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #00cc7a 100%);
            color: #002614;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0, 255, 157, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 255, 157, 0.5);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #0099ff 0%, #0066cc 100%);
            color: white;
        }
        
        .btn-full {
            width: 100%;
            justify-content: center;
            margin-top: 10px;
        }
        
        /* Calculation History */
        .history-card {
            margin-top: 30px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid rgba(0, 255, 157, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .history-table th {
            background: rgba(0, 40, 25, 0.8);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .history-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 255, 157, 0.1);
        }
        
        .history-table tr:last-child td {
            border-bottom: none;
        }
        
        .history-table tr:hover {
            background: rgba(0, 255, 157, 0.05);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 250px;
                padding: 15px;
            }
            
            .sidebar {
                width: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .calculator-card {
                padding: 20px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Navigation</h2>
        </div>
        
        <div class="sidebar-content">
            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-btn">
                    <i class="fas fa-home"></i>
                    <span class="sidebar-btn-text">Dashboard</span>
                </a>
                
                <div class="sidebar-divider"></div>
                
                <a href="tax_facts.html" class="sidebar-btn">
                    <i class="fas fa-book"></i>
                    <span class="sidebar-btn-text">Tax Facts</span>
                </a>
                
                <a href="tax_calculator.html" class="sidebar-btn active">
                    <i class="fas fa-calculator"></i>
                    <span class="sidebar-btn-text">Tax Calculator</span>
                </a>
                
                <a href="#" class="sidebar-btn" onclick="showHelp()">
                    <i class="fas fa-question-circle"></i>
                    <span class="sidebar-btn-text">Calculator Help</span>
                </a>
                
                <div class="sidebar-divider"></div>
                
                <a href="#" class="sidebar-btn" onclick="clearAllCalculations()">
                    <i class="fas fa-eraser"></i>
                    <span class="sidebar-btn-text">Clear All</span>
                </a>
                
                <a href="#" class="sidebar-btn" onclick="window.print()">
                    <i class="fas fa-print"></i>
                    <span class="sidebar-btn-text">Print Results</span>
                </a>
            </nav>
        </div>
        
        <div class="sidebar-footer">
            <p>Tax Calculator v1.0</p>
            <p>Real-time Calculations</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <header class="header">
            <h1>
                <i class="fas fa-calculator"></i>
                Philippine Tax Calculator
            </h1>
            <p>Calculate VAT, income tax, withholding tax, and other tax computations instantly. All calculations are based on current Philippine tax rates.</p>
        </header>
        
        <div class="calculator-container">
            <!-- VAT Calculator -->
            <div class="calculator-card">
                <h2><i class="fas fa-percentage"></i> VAT Calculator</h2>
                
                <div class="form-group">
                    <label for="vatType">Calculation Type</label>
                    <select id="vatType" class="form-control">
                        <option value="add">Add VAT to Amount</option>
                        <option value="extract">Extract VAT from Total</option>
                        <option value="vatable">Calculate Vatable Sales</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="vatAmount">Amount (₱)</label>
                    <div class="input-group">
                        <span class="currency">₱</span>
                        <input type="number" id="vatAmount" class="form-control" placeholder="Enter amount" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="vatRate">VAT Rate (%)</label>
                    <input type="number" id="vatRate" class="form-control" value="12" min="0" max="100" step="0.1">
                </div>
                
                <button class="btn btn-full" onclick="calculateVAT()">
                    <i class="fas fa-calculator"></i> Calculate VAT
                </button>
            </div>
            
            <!-- Income Tax Calculator -->
            <div class="calculator-card">
                <h2><i class="fas fa-money-bill-wave"></i> Income Tax Calculator</h2>
                
                <div class="form-group">
                    <label for="taxpayerType">Taxpayer Type</label>
                    <select id="taxpayerType" class="form-control">
                        <option value="individual">Individual (Compensation)</option>
                        <option value="self-employed">Self-Employed/Professional</option>
                        <option value="corporation">Corporation</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="taxableIncome">Taxable Income (₱)</label>
                    <div class="input-group">
                        <span class="currency">₱</span>
                        <input type="number" id="taxableIncome" class="form-control" placeholder="Annual taxable income" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Filing Status</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="filingStatus" value="single" checked>
                            Single
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="filingStatus" value="married">
                            Married
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="filingStatus" value="hoh">
                            Head of Family
                        </label>
                    </div>
                </div>
                
                <button class="btn btn-full" onclick="calculateIncomeTax()">
                    <i class="fas fa-calculator"></i> Calculate Income Tax
                </button>
            </div>
            
            <!-- Results Card -->
            <div class="calculator-card results-card">
                <h2><i class="fas fa-chart-bar"></i> Calculation Results</h2>
                
                <div class="results-grid" id="resultsContainer">
                    <div class="result-item">
                        <div class="result-label">Original Amount</div>
                        <div class="result-value" id="originalAmount">₱0.00</div>
                        <div class="result-subtext">Before tax calculation</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Tax Amount</div>
                        <div class="result-value" id="taxAmount">₱0.00</div>
                        <div class="result-subtext">Total tax payable</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Net/Gross Amount</div>
                        <div class="result-value" id="netAmount">₱0.00</div>
                        <div class="result-subtext">After tax calculation</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Effective Tax Rate</div>
                        <div class="result-value" id="effectiveRate">0%</div>
                        <div class="result-subtext">Tax as percentage</div>
                    </div>
                </div>
                
                <div style="margin-top: 25px; display: flex; gap: 15px;">
                    <button class="btn" onclick="saveCalculation()">
                        <i class="fas fa-save"></i> Save Calculation
                    </button>
                    <button class="btn btn-secondary" onclick="copyResults()">
                        <i class="fas fa-copy"></i> Copy Results
                    </button>
                </div>
            </div>
            
            <!-- Withholding Tax Calculator -->
            <div class="calculator-card">
                <h2><i class="fas fa-hand-holding-usd"></i> Withholding Tax Calculator</h2>
                
                <div class="form-group">
                    <label for="withholdingType">Withholding Tax Type</label>
                    <select id="withholdingType" class="form-control">
                        <option value="compensation">Compensation (BIR Form 1601C)</option>
                        <option value="expanded">Expanded (BIR Form 1601E)</option>
                        <option value="final">Final Withholding Tax</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="withholdingAmount">Payment Amount (₱)</label>
                    <div class="input-group">
                        <span class="currency">₱</span>
                        <input type="number" id="withholdingAmount" class="form-control" placeholder="Payment amount" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="withholdingRate">Withholding Rate (%)</label>
                    <input type="number" id="withholdingRate" class="form-control" value="1" min="0" max="100" step="0.1">
                </div>
                
                <button class="btn btn-full" onclick="calculateWithholdingTax()">
                    <i class="fas fa-calculator"></i> Calculate Withholding Tax
                </button>
            </div>
            
            <!-- Percentage Tax Calculator -->
            <div class="calculator-card">
                <h2><i class="fas fa-percent"></i> Percentage Tax Calculator</h2>
                
                <div class="form-group">
                    <label for="grossSales">Gross Sales/Receipts (₱)</label>
                    <div class="input-group">
                        <span class="currency">₱</span>
                        <input type="number" id="grossSales" class="form-control" placeholder="Monthly gross sales" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="percentageRate">Percentage Tax Rate (%)</label>
                    <input type="number" id="percentageRate" class="form-control" value="3" min="0" max="100" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="period">Tax Period</label>
                    <select id="period" class="form-control">
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>
                
                <button class="btn btn-full" onclick="calculatePercentageTax()">
                    <i class="fas fa-calculator"></i> Calculate Percentage Tax
                </button>
            </div>
        </div>
        
        <!-- Calculation History -->
        <div class="calculator-card history-card">
            <h2><i class="fas fa-history"></i> Calculation History</h2>
            
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Date & Time</th>
                        <th>Calculation Type</th>
                        <th>Amount</th>
                        <th>Tax Rate</th>
                        <th>Tax Amount</th>
                        <th>Result</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <!-- History rows will be added here -->
                </tbody>
            </table>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="clearHistory()">
                    <i class="fas fa-trash"></i> Clear History
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Format currency
        function formatCurrency(amount) {
            return '₱' + parseFloat(amount).toLocaleString('en-PH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Format percentage
        function formatPercent(rate) {
            return parseFloat(rate).toFixed(2) + '%';
        }
        
        // VAT Calculation
        function calculateVAT() {
            const amount = parseFloat(document.getElementById('vatAmount').value) || 0;
            const rate = parseFloat(document.getElementById('vatRate').value) || 12;
            const type = document.getElementById('vatType').value;
            
            let originalAmount, taxAmount, netAmount, effectiveRate;
            
            switch(type) {
                case 'add':
                    // Add VAT to amount
                    originalAmount = amount;
                    taxAmount = amount * (rate / 100);
                    netAmount = originalAmount + taxAmount;
                    effectiveRate = rate;
                    break;
                    
                case 'extract':
                    // Extract VAT from total
                    netAmount = amount;
                    originalAmount = amount / (1 + (rate / 100));
                    taxAmount = netAmount - originalAmount;
                    effectiveRate = (taxAmount / originalAmount) * 100;
                    break;
                    
                case 'vatable':
                    // Calculate vatable sales
                    taxAmount = amount;
                    originalAmount = taxAmount / (rate / 100);
                    netAmount = originalAmount + taxAmount;
                    effectiveRate = rate;
                    break;
            }
            
            // Update results
            document.getElementById('originalAmount').textContent = formatCurrency(originalAmount);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('netAmount').textContent = formatCurrency(netAmount);
            document.getElementById('effectiveRate').textContent = formatPercent(effectiveRate);
            
            // Save to history
            saveToHistory('VAT Calculation', amount, rate, taxAmount, netAmount);
        }
        
        // Income Tax Calculation
        function calculateIncomeTax() {
            const income = parseFloat(document.getElementById('taxableIncome').value) || 0;
            const type = document.getElementById('taxpayerType').value;
            const status = document.querySelector('input[name="filingStatus"]:checked').value;
            
            let taxAmount, effectiveRate;
            
            if (type === 'corporation') {
                // Corporate tax: 25% flat rate
                taxAmount = income * 0.25;
                effectiveRate = 25;
            } else {
                // Individual tax: graduated rates (2024 rates)
                let taxable = income;
                
                // Standard deduction: ₱250,000
                if (taxable <= 250000) {
                    taxAmount = 0;
                } else {
                    taxable -= 250000;
                    
                    if (taxable <= 400000) {
                        taxAmount = taxable * 0.20;
                    } else if (taxable <= 800000) {
                        taxAmount = 80000 + ((taxable - 400000) * 0.25);
                    } else if (taxable <= 2000000) {
                        taxAmount = 280000 + ((taxable - 800000) * 0.30);
                    } else if (taxable <= 8000000) {
                        taxAmount = 880000 + ((taxable - 2000000) * 0.32);
                    } else {
                        taxAmount = 2480000 + ((taxable - 8000000) * 0.35);
                    }
                }
                
                effectiveRate = (taxAmount / income) * 100;
            }
            
            // Update results
            document.getElementById('originalAmount').textContent = formatCurrency(income);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('netAmount').textContent = formatCurrency(income - taxAmount);
            document.getElementById('effectiveRate').textContent = formatPercent(effectiveRate);
            
            // Save to history
            saveToHistory('Income Tax', income, effectiveRate, taxAmount, income - taxAmount);
        }
        
        // Withholding Tax Calculation
        function calculateWithholdingTax() {
            const amount = parseFloat(document.getElementById('withholdingAmount').value) || 0;
            const rate = parseFloat(document.getElementById('withholdingRate').value) || 1;
            const type = document.getElementById('withholdingType').value;
            
            let taxAmount, description;
            
            switch(type) {
                case 'compensation':
                    // Compensation withholding
                    taxAmount = amount * (rate / 100);
                    description = 'Compensation Withholding';
                    break;
                    
                case 'expanded':
                    // Expanded withholding
                    taxAmount = amount * (rate / 100);
                    description = 'Expanded Withholding';
                    break;
                    
                case 'final':
                    // Final withholding
                    taxAmount = amount * (rate / 100);
                    description = 'Final Withholding';
                    break;
            }
            
            // Update results
            document.getElementById('originalAmount').textContent = formatCurrency(amount);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('netAmount').textContent = formatCurrency(amount - taxAmount);
            document.getElementById('effectiveRate').textContent = formatPercent(rate);
            
            // Save to history
            saveToHistory(description, amount, rate, taxAmount, amount - taxAmount);
        }
        
        // Percentage Tax Calculation
        function calculatePercentageTax() {
            const sales = parseFloat(document.getElementById('grossSales').value) || 0;
            const rate = parseFloat(document.getElementById('percentageRate').value) || 3;
            const period = document.getElementById('period').value;
            
            // Adjust for period
            let multiplier = 1;
            switch(period) {
                case 'monthly': multiplier = 1; break;
                case 'quarterly': multiplier = 3; break;
                case 'annually': multiplier = 12; break;
            }
            
            const taxAmount = (sales * multiplier) * (rate / 100);
            const totalSales = sales * multiplier;
            
            // Update results
            document.getElementById('originalAmount').textContent = formatCurrency(totalSales);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('netAmount').textContent = formatCurrency(totalSales - taxAmount);
            document.getElementById('effectiveRate').textContent = formatPercent(rate);
            
            // Save to history
            saveToHistory('Percentage Tax', totalSales, rate, taxAmount, totalSales - taxAmount);
        }
        
        // Save calculation to history
        function saveToHistory(type, amount, rate, tax, result) {
            const now = new Date();
            const timestamp = now.toLocaleString('en-PH');
            
            const historyBody = document.getElementById('historyBody');
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${timestamp}</td>
                <td>${type}</td>
                <td>${formatCurrency(amount)}</td>
                <td>${formatPercent(rate)}</td>
                <td>${formatCurrency(tax)}</td>
                <td>${formatCurrency(result)}</td>
                <td>
                    <button onclick="deleteHistoryRow(this)" style="background: none; border: none; color: var(--danger-color); cursor: pointer;">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button onclick="reuseCalculation(this)" style="background: none; border: none; color: var(--primary-color); cursor: pointer; margin-left: 10px;">
                        <i class="fas fa-redo"></i>
                    </button>
                </td>
            `;
            
            historyBody.insertBefore(row, historyBody.firstChild);
            
            // Limit history to 10 entries
            if (historyBody.children.length > 10) {
                historyBody.removeChild(historyBody.lastChild);
            }
            
            // Save to localStorage
            saveHistoryToStorage();
        }
        
        // Delete history row
        function deleteHistoryRow(button) {
            const row = button.closest('tr');
            row.parentNode.removeChild(row);
            saveHistoryToStorage();
        }
        
        // Reuse calculation
        function reuseCalculation(button) {
            const row = button.closest('tr');
            const cells = row.cells;
            
            // Extract data from row
            const type = cells[1].textContent;
            const amount = parseFloat(cells[2].textContent.replace(/[^0-9.]/g, ''));
            const rate = parseFloat(cells[3].textContent);
            
            // Set values based on type
            if (type.includes('VAT')) {
                document.getElementById('vatAmount').value = amount;
                document.getElementById('vatRate').value = rate;
            } else if (type.includes('Income')) {
                document.getElementById('taxableIncome').value = amount;
            } else if (type.includes('Withholding')) {
                document.getElementById('withholdingAmount').value = amount;
                document.getElementById('withholdingRate').value = rate;
            } else if (type.includes('Percentage')) {
                document.getElementById('grossSales').value = amount;
                document.getElementById('percentageRate').value = rate;
            }
        }
        
        // Save history to localStorage
        function saveHistoryToStorage() {
            const history = [];
            const rows = document.querySelectorAll('#historyBody tr');
            
            rows.forEach(row => {
                const cells = row.cells;
                history.push({
                    timestamp: cells[0].textContent,
                    type: cells[1].textContent,
                    amount: cells[2].textContent,
                    rate: cells[3].textContent,
                    tax: cells[4].textContent,
                    result: cells[5].textContent
                });
            });
            
            localStorage.setItem('taxCalculatorHistory', JSON.stringify(history));
        }
        
        // Load history from localStorage
        function loadHistoryFromStorage() {
            const history = JSON.parse(localStorage.getItem('taxCalculatorHistory') || '[]');
            const historyBody = document.getElementById('historyBody');
            
            history.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.timestamp}</td>
                    <td>${item.type}</td>
                    <td>${item.amount}</td>
                    <td>${item.rate}</td>
                    <td>${item.tax}</td>
                    <td>${item.result}</td>
                    <td>
                        <button onclick="deleteHistoryRow(this)" style="background: none; border: none; color: var(--danger-color); cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="reuseCalculation(this)" style="background: none; border: none; color: var(--primary-color); cursor: pointer; margin-left: 10px;">
                            <i class="fas fa-redo"></i>
                        </button>
                    </td>
                `;
                historyBody.appendChild(row);
            });
        }
        
        // Clear all calculations
        function clearAllCalculations() {
            if (confirm('Are you sure you want to clear all calculations and history?')) {
                // Clear form fields
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.value = '';
                });
                
                // Clear results
                document.getElementById('originalAmount').textContent = '₱0.00';
                document.getElementById('taxAmount').textContent = '₱0.00';
                document.getElementById('netAmount').textContent = '₱0.00';
                document.getElementById('effectiveRate').textContent = '0%';
                
                // Clear history
                clearHistory();
            }
        }
        
        // Clear history
        function clearHistory() {
            if (confirm('Clear all calculation history?')) {
                document.getElementById('historyBody').innerHTML = '';
                localStorage.removeItem('taxCalculatorHistory');
            }
        }
        
        // Copy results to clipboard
        function copyResults() {
            const results = {
                originalAmount: document.getElementById('originalAmount').textContent,
                taxAmount: document.getElementById('taxAmount').textContent,
                netAmount: document.getElementById('netAmount').textContent,
                effectiveRate: document.getElementById('effectiveRate').textContent
            };
            
            const text = `Tax Calculation Results:
Original Amount: ${results.originalAmount}
Tax Amount: ${results.taxAmount}
Net Amount: ${results.netAmount}
Effective Tax Rate: ${results.effectiveRate}`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Results copied to clipboard!');
            });
        }
        
        // Save calculation (simulated)
        function saveCalculation() {
            alert('Calculation saved! (This is a demo feature)');
        }
        
        // Show help
        function showHelp() {
            alert('Tax Calculator Help:\n\n1. VAT Calculator: Calculate VAT amounts\n2. Income Tax: Compute individual/corporate tax\n3. Withholding Tax: Calculate various withholding taxes\n4. Percentage Tax: For non-VAT businesses\n\nAll calculations use current Philippine tax rates.');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadHistoryFromStorage();
            
            // Add event listeners for Enter key
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const card = this.closest('.calculator-card');
                        const button = card.querySelector('.btn');
                        if (button) button.click();
                    }
                });
            });
            
            // Auto-calculate on rate change
            document.getElementById('vatRate').addEventListener('change', calculateVAT);
            document.getElementById('vatType').addEventListener('change', calculateVAT);
            document.getElementById('withholdingRate').addEventListener('change', calculateWithholdingTax);
            document.getElementById('withholdingType').addEventListener('change', calculateWithholdingTax);
            document.getElementById('percentageRate').addEventListener('change', calculatePercentageTax);
            document.getElementById('period').addEventListener('change', calculatePercentageTax);
        });
    </script>
</body>
</html>